import React from "react";
import { X } from "lucide-react";
import { useDiagramContext } from "../../store/DiagramContext";

// Definisikan interface untuk template
interface TemplateDefinition {
  name: string;
  description: string;
  previewSvg: string;
  shapes: any[]; // Sesuaikan dengan tipe shape yang Anda gunakan
  connections: any[]; // Sesuaikan dengan tipe connection yang Anda gunakan
}

// Definisikan templates GSN dan SACM
const TEMPLATES: Record<string, TemplateDefinition> = {
  gsn: {
    name: "GSN Template",
    description: "Goal Structuring Notation template",
    previewSvg: `<svg
    xmlns="http://www.w3.org/2000/svg"
    width="350"
    height="175"
    viewBox="0 0 631.000000 669.000000"
    preserveAspectRatio="xMidYMid meet"
    {...props}
  >
    <g
      transform="translate(0.000000,669.000000) scale(0.100000,-0.100000)"
      fill="#000000"
      stroke="none"
    >
      <path d="M2150 6465 l0 -225 -230 0 c-198 0 -230 2 -230 15 0 19 -4 19 -41 -1 -17 -8 -32 -14 -33 -12 -1 2 -8 32 -15 67 -31 159 -140 276 -296 317 -38 11 -156 14 -500 14 -477 0 -502 -2 -594 -49 -24 -13 -65 -44 -91 -71 -222 -221 -119 -595 185 -676 38 -11 156 -14 500 -14 477 0 502 2 594 49 58 30 133 107 164 168 14 27 31 78 38 114 7 35 14 65 15 67 1 2 16 -4 33 -12 37 -20 41 -20 41 -1 0 13 32 15 230 15 l230 0 0 -225 0 -225 425 0 425 0 0 -455 c0 -398 -2 -455 -15 -455 -18 0 -18 -8 0 -40 8 -14 14 -28 15 -32 0 -5 -157 -8 -350 -8 l-349 0 -10 -37 c-21 -81 -191 -763 -191 -768 0 -3 203 -5 451 -5 l452 0 -7 -55 c-24 -207 -183 -353 -464 -424 -144 -37 -279 -51 -582 -61 -363 -11 -481 -25 -658 -76 -226 -66 -365 -194 -388 -357 -5 -35 -10 -47 -20 -43 -18 7 -18 -8 1 -44 l16 -30 -351 0 -350 0 0 -455 0 -455 350 0 350 0 0 -261 c0 -228 -2 -260 -15 -255 -19 7 -19 -7 0 -43 l14 -28 -67 -7 c-207 -20 -415 -159 -519 -343 -113 -203 -113 -463 0 -666 79 -140 217 -254 376 -311 79 -28 96 -30 216 -30 120 0 137 2 216 30 159 57 297 171 376 311 113 203 113 463 0 666 -104 185 -312 323 -519 343 -37 4 -68 9 -68 13 1 3 7 17 15 31 18 32 18 41 0 34 -13 -5 -15 27 -15 255 l0 261 350 0 350 0 0 455 0 455 -350 0 c-192 0 -350 3 -350 8 1 4 7 18 15 32 19 33 18 41 -1 33 -15 -5 -16 0 -10 43 22 151 144 271 346 338 171 56 314 74 685 86 328 10 422 20 583 60 242 61 390 169 453 328 18 47 18 44 19 -407 0 -399 -2 -452 -15 -447 -19 7 -19 -7 0 -44 l16 -30 -401 0 -400 0 0 -455 0 -455 398 0 398 0 12 -59 c9 -44 22 -70 53 -105 78 -88 163 -113 423 -126 277 -13 385 -56 411 -162 6 -22 4 -28 -9 -28 -9 0 -16 -5 -16 -10 0 -13 29 -70 35 -70 6 0 35 57 35 70 0 5 -7 10 -15 10 -48 0 13 83 88 120 91 45 185 59 452 70 254 10 326 18 426 50 117 36 202 116 216 202 l6 38 398 0 399 0 0 455 0 455 -400 0 c-220 0 -400 3 -400 8 1 4 7 18 15 32 18 32 19 41 1 34 -10 -4 -15 8 -20 43 -23 163 -162 291 -388 357 -177 51 -295 65 -658 76 -303 10 -438 24 -582 61 -281 71 -440 217 -464 424 l-7 55 351 0 351 0 10 38 c21 80 191 762 191 767 0 3 -202 5 -450 5 -247 0 -450 3 -450 8 1 4 7 18 15 32 18 32 18 40 0 40 -13 0 -15 57 -15 455 l0 455 425 0 425 0 0 225 0 225 380 0 c331 0 380 -2 380 -15 0 -19 4 -19 41 1 17 8 32 14 33 12 1 -2 8 -32 15 -67 31 -159 140 -276 296 -317 38 -11 156 -14 500 -14 477 0 502 2 594 49 24 13 65 44 91 71 222 221 119 595 -185 676 -38 11 -156 14 -500 14 -477 0 -502 -2 -594 -49 -58 -30 -133 -107 -164 -168 -14 -27 -31 -78 -38 -114 -7 -35 -14 -65 -15 -67 -1 -2 -16 4 -33 12 -37 20 -41 20 -41 1 0 -13 -49 -15 -380 -15 l-380 0 0 225 0 225 -855 0 -855 0 0 -225z m1700 -230 l0 -445 -845 0 -845 0 0 445 0 445 845 0 845 0 0 -445z m-2495 366 c44 -18 78 -42 126 -90 88 -88 113 -150 113 -276 0 -126 -25 -188 -113 -276 -48 -48 -82 -72 -126 -90 l-60 -24 -490 0 -490 0 -60 24 c-44 18 -78 42 -126 90 -88 88 -113 150 -113 276 0 114 25 183 95 260 59 64 101 91 177 116 52 17 95 18 532 16 l475 -2 60 -24z m4700 0 c44 -18 78 -42 126 -90 88 -88 113 -150 113 -276 0 -126 -25 -188 -113 -276 -48 -48 -82 -72 -126 -90 l-60 -24 -490 0 -490 0 -60 24 c-44 18 -78 42 -126 90 -88 88 -113 150 -113 276 0 114 25 183 95 260 59 64 101 91 177 116 52 17 95 18 532 16 l475 -2 60 -24z m-4375 -366 c0 -23 -2 -24 -26 -13 l-25 12 23 13 c13 7 24 12 26 13 1 0 2 -11 2 -25z m2998 0 c-2 -1 -13 -8 -25 -14 -21 -11 -23 -9 -23 13 0 24 2 25 25 14 14 -6 24 -12 23 -13z m-1659 -1397 c-6 -13 -13 -24 -14 -26 -1 -1 -7 9 -13 23 -11 23 -10 25 14 25 22 0 24 -2 13 -22z m789 -415 c-49 -197 -93 -375 -99 -395 l-10 -38 -793 0 -794 0 90 358 c49 196 93 374 99 395 l10 37 793 0 794 0 -90 -357z m-738 -687 c63 -104 221 -198 412 -246 161 -40 255 -50 583 -60 371 -12 514 -30 685 -86 202 -67 324 -187 346 -338 6 -43 5 -48 -10 -43 -20 8 -20 -5 -1 -43 l16 -30 -401 0 -400 0 0 -455 0 -455 400 0 c313 0 400 -3 400 -12 0 -60 -51 -138 -113 -177 -95 -58 -220 -80 -522 -91 -329 -12 -443 -38 -521 -116 -38 -37 -44 -40 -49 -24 -3 11 -24 35 -46 53 -65 56 -190 87 -359 87 -299 1 -450 77 -476 238 l-7 42 402 0 401 0 0 455 0 455 -400 0 c-220 0 -400 3 -400 8 1 4 7 18 15 32 18 32 18 41 0 34 -13 -5 -15 48 -15 447 1 451 1 454 19 407 10 -26 28 -63 41 -82z m-1470 -1301 l0 -445 -695 0 -695 0 0 445 0 445 695 0 695 0 0 -445z m2200 0 l0 -445 -795 0 -795 0 0 445 0 445 795 0 795 0 0 -445z m2100 0 l0 -445 -795 0 -795 0 0 445 0 445 795 0 795 0 0 -445z m-1980 -962 c0 -10 -20 -40 -20 -31 0 3 -3 13 -6 22 -4 11 -1 16 10 16 9 0 16 -3 16 -7z m-2875 -108 c146 -31 301 -129 390 -246 94 -125 135 -249 135 -409 0 -267 -135 -484 -375 -601 -380 -186 -832 25 -939 438 -21 80 -21 246 0 326 51 196 175 348 359 438 136 66 284 85 430 54z" />
      <path d="M2392 6418 c-29 -29 -4 -84 35 -76 25 5 31 48 6 47 -10 0 -13 -3 -5 -6 22 -9 14 -35 -10 -31 -18 2 -23 10 -23 33 0 33 30 48 47 23 8 -10 9 -10 5 2 -5 19 -39 24 -55 8z" />
      <path d="M2476 6421 c-3 -5 3 -7 14 -4 26 7 26 -18 0 -42 -27 -25 -25 -35 8 -34 25 1 25 1 4 7 l-23 7 21 18 c12 10 20 26 18 35 -4 19 -33 28 -42 13z" />
      <path d="M342 6418 c-16 -16 -15 -53 3 -68 18 -15 47 -10 53 10 5 13 3 13 -11 1 -23 -19 -47 -7 -47 24 0 31 24 42 48 24 15 -13 16 -12 3 4 -16 20 -32 22 -49 5z" />
      <path d="M420 6421 c0 -6 7 -8 17 -4 13 5 15 2 11 -15 -3 -11 -1 -23 5 -25 6 -2 7 -9 3 -16 -5 -7 -14 -10 -22 -7 -8 3 -14 1 -14 -4 0 -15 40 -12 45 3 8 21 -11 72 -28 75 -9 2 -17 -1 -17 -7z" />
      <path d="M5042 6418 c-16 -16 -15 -53 3 -68 18 -15 47 -10 53 10 5 13 3 13 -11 1 -23 -19 -47 -7 -47 24 0 31 24 42 48 24 15 -13 16 -12 3 4 -16 20 -32 22 -49 5z" />
      <path d="M5133 6400 c-20 -32 -21 -35 -5 -39 9 -2 20 -8 23 -13 10 -16 15 14 9 52 l-5 35 -22 -35z m13 -27 c-10 -10 -19 5 -10 18 6 11 8 11 12 0 2 -7 1 -15 -2 -18z" />
      <path d="M2337 4574 c-15 -15 -6 -34 18 -40 14 -3 25 -12 25 -20 0 -16 -36 -19 -43 -4 -3 6 -4 5 -3 -2 2 -7 13 -13 27 -13 34 0 38 32 5 45 -14 5 -26 14 -26 20 0 13 37 13 43 0 3 -6 4 -5 3 2 -3 14 -38 23 -49 12z" />
      <path d="M2426 4565 c-17 -13 -17 -15 -4 -15 11 0 18 -11 21 -32 3 -25 4 -22 5 15 1 26 1 47 0 47 -2 0 -12 -7 -22 -15z" />
      <path d="M342 2618 c-29 -29 -4 -84 35 -76 25 5 31 48 6 47 -10 0 -13 -3 -5 -6 22 -9 14 -35 -10 -31 -18 2 -23 10 -23 33 0 33 30 48 47 23 8 -10 9 -10 5 2 -5 19 -39 24 -55 8z" />
      <path d="M437 2601 c-21 -35 -21 -41 -3 -41 8 0 17 -6 19 -12 10 -24 23 10 19 47 -5 43 -12 44 -35 6z m13 -16 c0 -8 -4 -15 -10 -15 -5 0 -7 7 -4 15 4 8 8 15 10 15 2 0 4 -7 4 -15z" />
      <path d="M2342 2668 c-29 -29 -4 -84 35 -76 25 5 31 48 6 47 -10 0 -13 -3 -5 -6 22 -9 14 -35 -10 -31 -18 2 -23 10 -23 33 0 33 30 48 47 23 8 -10 9 -10 5 2 -5 19 -39 24 -55 8z" />
      <path d="M2430 2671 c0 -5 -3 -16 -6 -24 -4 -12 0 -14 15 -10 17 4 21 1 21 -17 0 -18 -4 -21 -21 -17 -16 4 -19 3 -11 -5 16 -16 42 -2 42 22 0 11 -7 23 -15 26 -20 8 -19 21 3 27 13 4 11 5 -5 6 -13 0 -23 -3 -23 -8z" />
      <path d="M4442 2668 c-29 -29 -4 -84 35 -76 25 5 31 48 6 47 -10 0 -13 -3 -5 -6 22 -9 14 -35 -10 -31 -18 2 -23 10 -23 33 0 33 30 48 47 23 8 -10 9 -10 5 2 -5 19 -39 24 -55 8z" />
      <path d="M4524 2656 c-8 -35 4 -68 24 -64 26 5 28 48 3 55 -11 3 -18 10 -15 15 3 5 13 7 21 4 8 -3 11 -1 8 4 -11 18 -35 10 -41 -14z m36 -36 c0 -11 -4 -20 -9 -20 -14 0 -23 18 -16 30 10 17 25 11 25 -10z" />
      <path d="M337 1004 c-15 -15 -6 -34 18 -40 14 -3 25 -12 25 -20 0 -16 -36 -19 -43 -4 -3 6 -4 5 -3 -2 2 -7 13 -13 27 -13 34 0 38 32 5 45 -14 5 -26 14 -26 20 0 13 37 13 43 0 3 -6 4 -5 3 2 -3 14 -38 23 -49 12z" />
      <path d="M490 995 c-8 -9 -8 -15 -2 -15 6 0 13 -15 15 -32 3 -25 4 -22 5 15 2 51 1 54 -18 32z" />
      <path d="M412 953 c1 -38 1 -38 5 -5 5 40 25 38 35 -4 6 -27 6 -27 5 6 -2 28 -6 36 -24 38 -21 3 -23 -1 -21 -35z" />
      <path d="M3724 1390 c-240 -63 -435 -257 -501 -501 -24 -87 -24 -271 0 -358 53 -195 189 -361 370 -453 75 -37 196 -68 261 -67 45 2 42 3 -25 10 -162 17 -294 82 -415 204 -166 167 -234 392 -189 623 47 236 232 444 464 522 35 12 98 25 140 29 71 8 73 8 21 9 -30 1 -87 -8 -126 -18z" />
      <path d="M3981 1399 c162 -17 294 -82 415 -204 214 -215 262 -518 127 -794 -37 -77 -61 -110 -127 -176 -121 -122 -253 -187 -415 -204 -67 -7 -70 -8 -25 -10 164 -4 380 109 499 261 107 137 149 260 149 438 0 178 -42 301 -149 438 -119 152 -335 265 -499 261 -45 -2 -42 -3 25 -10z" />
      <path d="M3337 973 c-13 -13 -7 -23 26 -38 28 -14 30 -14 13 0 -11 8 -23 15 -28 15 -4 0 -8 5 -8 11 0 6 9 9 20 6 11 -3 20 -1 20 4 0 10 -33 12 -43 2z" />
      <path d="M3466 971 c-4 -5 3 -7 14 -4 23 6 27 -15 8 -38 -7 -7 -4 -6 6 3 11 9 16 23 13 32 -7 17 -32 22 -41 7z" />
      <path d="M3401 928 c2 -31 2 -31 6 -5 5 33 24 31 35 -4 6 -22 7 -21 5 6 -2 23 -7 31 -24 33 -20 3 -23 -1 -22 -30z" />
      <path d="M3338 908 c6 -6 18 -8 28 -6 14 3 12 5 -9 10 -19 3 -25 2 -19 -4z" />
      <path d="M3473 903 c9 -2 23 -2 30 0 6 3 -1 5 -18 5 -16 0 -22 -2 -12 -5z" />
    </g>
  </svg>`,
    shapes: [
      // Definisi shapes untuk template custom
      {
        type: "goal1",
        title: "Goals",
        x: 240,
        y: 48,
        width: 150,
        height: 80,
        text: "Complex Element",
      },
      {
        type: "goal2",
        title: "Sub Element 1",
        x: 500,
        y: 64,
        width: 100,
        height: 50,
        text: "Sub Element 1",
      },
      {
        type: "goal2",
        title: "Sub Element 2",
        x: 30,
        y: 64,
        width: 100,
        height: 50,
        text: "Sub Element 2",
      },
      {
        type: "goal4",
        title: "Sub Element 3",
        x: 240,
        y: 250,
        width: 150,
        height: 60,
        text: "Sub Element 3",
      },
      {
        type: "goal1",
        title: "Goals",
        x: 40,
        y: 450,
        width: 150,
        height: 80,
        text: "Sub Element 4",
      },
      {
        type: "goal1",
        title: "Goals",
        x: 240,
        y: 450,
        width: 150,
        height: 80,
        text: "Sub Element 4",
      },
      {
        type: "goal1",
        title: "Goals",
        x: 440,
        y: 450,
        width: 150,
        height: 80,
        text: "Sub Element 4",
      },
      {
        type: "goal3",
        title: "Goals",
        x: 60,
        y: 600,
        width: 110,
        height: 100,
        text: "Sub Element 5",
      },
      {
        type: "goal3",
        title: "Goals",
        x: 360,
        y: 600,
        width: 110,
        height: 100,
        text: "Sub Element 5",
      },
    ],
    connections: [
      {
        from: "0",
        to: "1",
        style: "line" as const,
        fromPoint: "right",
        toPoint: "left",
      },
      {
        from: "0",
        to: "2",
        style: "line" as const,
        fromPoint: "left",
        toPoint: "right",
      },
      {
        from: "0",
        to: "3",
        style: "line" as const,
        fromPoint: "bottom",
        toPoint: "top",
      },
      {
        from: "3",
        to: "4",
        style: "line" as const,
        fromPoint: "bottom",
        toPoint: "top",
      },
      {
        from: "3",
        to: "5",
        style: "line" as const,
        fromPoint: "bottom",
        toPoint: "top",
      },
      {
        from: "3",
        to: "6",
        style: "line" as const,
        fromPoint: "bottom",
        toPoint: "top",
      },
      {
        from: "4",
        to: "7",
        style: "line" as const,
        fromPoint: "bottom",
        toPoint: "top",
      },
      {
        from: "5",
        to: "8",
        style: "line" as const,
        fromPoint: "bottom",
        toPoint: "top",
      },
      {
        from: "6",
        to: "8",
        style: "line" as const,
        fromPoint: "bottom",
        toPoint: "top",
      },
    ],
  },

  sacm: {
    name: "SACM Template",
    description: "Structured Assurance Case Meta-model template",
    previewSvg: `<svg
    xmlns="http://www.w3.org/2000/svg"
    width="350"
    height="175"
    viewBox="0 0 739.000000 664.000000"
    preserveAspectRatio="xMidYMid meet"
    {...props}
  >
    <g
      transform="translate(0.000000,664.000000) scale(0.100000,-0.100000)"
      fill="#000000"
      stroke="none"
    >
      <path d="M3000 6185 l0 -455 855 0 855 0 0 455 0 455 -855 0 -855 0 0 -455z m1700 0 l0 -445 -845 0 -845 0 0 445 0 445 845 0 845 0 0 -445z" />
      <path d="M3142 6478 c-29 -29 -4 -84 35 -76 25 5 31 48 6 47 -10 0 -13 -3 -5 -6 22 -9 14 -35 -10 -31 -18 2 -23 10 -23 33 0 33 30 48 47 23 8 -10 9 -10 5 2 -5 19 -39 24 -55 8z" />
      <path d="M3226 6481 c-3 -5 3 -7 14 -4 26 7 26 -18 0 -42 -27 -25 -25 -35 8 -34 25 1 25 1 4 7 l-23 7 21 18 c12 10 20 26 18 35 -4 19 -33 28 -42 13z" />
      <path d="M3887 5675 c-21 -44 -21 -46 -2 -39 13 5 15 -23 15 -219 0 -191 -2 -226 -15 -231 -8 -3 -15 -14 -15 -24 0 -13 -32 -34 -120 -77 -65 -32 -118 -61 -116 -63 2 -2 54 22 116 53 67 34 119 54 129 50 20 -6 16 72 45 -885 9 -272 15 -507 16 -522 l0 -28 -420 0 -420 0 0 -405 0 -405 459 0 459 0 7 -30 c7 -30 25 -42 25 -16 0 7 11 21 25 30 21 14 69 16 380 16 l355 0 0 405 0 405 -429 0 -429 0 -6 168 c-3 92 -11 356 -16 587 -5 231 -12 477 -15 546 -5 111 -4 127 10 133 11 4 73 -25 168 -78 179 -98 204 -111 194 -101 -4 5 -82 50 -175 101 -128 70 -168 97 -170 114 -2 11 -10 24 -18 27 -11 4 -14 45 -14 229 0 194 2 223 15 218 19 -8 18 3 -3 44 l-18 33 -17 -36z m913 -2390 l0 -395 -845 0 -845 0 0 395 0 395 845 0 845 0 0 -395z" />
      <path d="M3192 3468 c-29 -29 -4 -84 35 -76 25 5 31 48 6 47 -10 0 -13 -3 -5 -6 22 -9 14 -35 -10 -31 -18 2 -23 10 -23 33 0 33 30 48 47 23 8 -10 9 -10 5 2 -5 19 -39 24 -55 8z" />
      <path d="M3280 3471 c0 -5 -3 -16 -6 -24 -4 -12 0 -14 15 -10 17 4 21 1 21 -17 0 -18 -4 -21 -21 -17 -16 4 -19 3 -11 -5 16 -16 42 -2 42 22 0 11 -7 23 -15 26 -20 8 -19 21 3 27 13 4 11 5 -5 6 -13 0 -23 -3 -23 -8z" />
      <path d="M3480 4955 c-69 -35 -120 -64 -115 -64 6 0 66 29 135 64 69 35 121 64 115 64 -5 0 -66 -29 -135 -64z" />
      <path d="M4305 4933 c8 -8 1736 -963 1815 -1003 14 -7 21 -8 15 -3 -8 8 -1736 963 -1815 1003 -14 7 -20 8 -15 3z" />
      <path d="M3065 4755 c-148 -73 -267 -134 -264 -134 4 -1 130 59 280 133 151 74 270 134 264 134 -5 0 -131 -60 -280 -133z" />
      <path d="M2372 4422 c-221 -107 -401 -197 -399 -199 4 -3 806 382 815 392 16 16 -52 -16 -416 -193z" />
      <path d="M1542 4022 c-221 -107 -401 -197 -399 -199 4 -3 806 382 815 392 16 16 -52 -16 -416 -193z" />
      <path d="M6150 3916 c0 -2 81 -49 179 -103 l180 -98 -415 -3 -414 -2 0 -405 0 -405 478 -1 c346 -1 468 -4 445 -11 -33 -11 -45 -28 -19 -28 7 0 20 -10 29 -22 14 -23 15 -23 27 20 l13 42 369 0 368 0 0 405 0 405 -427 0 -427 0 -185 101 c-102 56 -189 104 -193 106 -5 2 -8 2 -8 -1z m1230 -611 l0 -395 -845 0 -845 0 0 395 0 395 845 0 845 0 0 -395z" />
      <path d="M5822 3488 c-29 -29 -4 -84 35 -76 25 5 31 48 6 47 -10 0 -13 -3 -5 -6 22 -9 14 -35 -10 -31 -18 2 -23 10 -23 33 0 33 30 48 47 23 8 -10 9 -10 5 2 -5 19 -39 24 -55 8z" />
      <path d="M5904 3476 c-8 -35 4 -68 24 -64 26 5 28 48 3 55 -11 3 -18 10 -15 15 3 5 13 7 21 4 8 -3 11 -1 8 4 -11 18 -35 10 -41 -14z m36 -36 c0 -21 -15 -27 -25 -10 -7 12 2 30 16 30 5 0 9 -9 9 -20z" />
      <path d="M990 3755 l-125 -64 -432 0 -433 -1 0 -405 0 -405 425 0 c234 0 425 -3 425 -7 -1 -5 -7 -19 -15 -33 -18 -32 -18 -41 0 -34 13 5 15 -20 15 -194 0 -165 -3 -202 -15 -212 -8 -7 -15 -18 -15 -25 0 -7 7 -18 15 -25 13 -11 15 -65 15 -376 l0 -364 -225 0 -225 0 0 -755 0 -755 50 0 50 0 0 -50 0 -50 455 0 455 0 0 705 0 705 -50 0 -50 0 0 100 0 100 -225 0 -225 0 0 364 c0 311 2 365 15 376 8 7 15 18 15 25 0 7 -7 18 -15 25 -22 19 -22 412 0 404 19 -8 19 4 0 36 -8 14 -14 28 -15 33 0 4 191 7 425 7 l425 0 0 405 0 405 -412 1 -413 0 125 64 c69 35 121 64 115 64 -5 0 -66 -29 -135 -64z m710 -470 l0 -395 -845 0 -845 0 0 395 0 395 845 0 845 0 0 -395z m-400 -2430 l0 -745 -445 0 -445 0 0 745 0 745 445 0 445 0 0 -745z m100 -150 l0 -695 -445 0 -445 0 0 45 0 45 400 0 400 0 0 650 0 650 45 0 45 0 0 -695z" />
      <path d="M92 3468 c-29 -29 -4 -84 35 -76 25 5 31 48 6 47 -10 0 -13 -3 -5 -6 22 -9 14 -35 -10 -31 -18 2 -23 10 -23 33 0 33 30 48 47 23 8 -10 9 -10 5 2 -5 19 -39 24 -55 8z" />
      <path d="M187 3451 c-21 -35 -21 -41 -3 -41 8 0 17 -6 19 -12 10 -24 23 10 19 47 -5 43 -12 44 -35 6z m13 -16 c0 -8 -4 -15 -10 -15 -5 0 -7 7 -4 15 4 8 8 15 10 15 2 0 4 -7 4 -15z" />
      <path d="M455 1570 c-9 -14 3 -30 33 -41 19 -8 23 -12 13 -22 -9 -9 -16 -9 -32 2 -18 10 -20 10 -17 -1 6 -18 42 -22 56 -6 13 17 5 30 -28 45 -23 10 -24 11 -6 19 13 5 21 3 24 -4 2 -7 8 -12 14 -12 6 0 6 6 -2 15 -14 17 -46 20 -55 5z" />
      <path d="M616 1565 c-17 -13 -17 -15 -4 -15 11 0 18 -11 21 -32 3 -25 4 -22 5 15 1 26 1 47 0 47 -2 0 -12 -7 -22 -15z" />
      <path d="M531 1523 c1 -36 2 -36 8 -9 9 42 29 44 34 4 l4 -33 1 38 c2 33 0 37 -23 37 -22 0 -25 -4 -24 -37z" />
      <path d="M1213 1538 c-38 -12 -42 -23 -13 -31 11 -3 20 -12 20 -21 0 -25 17 -19 24 8 3 13 9 31 12 40 7 18 3 18 -43 4z" />
      <path d="M1135 1428 l-70 -73 73 70 c39 38 72 71 72 72 0 8 -11 -2 -75 -69z" />
      <path d="M4075 2832 c374 -347 495 -466 495 -488 0 -23 4 -26 43 -28 9 -1 188 -158 396 -351 l379 -350 -194 -3 -194 -2 0 -755 0 -755 50 0 50 0 0 -50 0 -50 455 0 455 0 0 705 0 705 -50 0 -50 0 0 100 0 100 -252 0 -253 0 -385 356 c-212 196 -385 363 -385 372 0 27 -14 42 -41 42 -18 0 -88 60 -274 235 -137 129 -253 235 -257 235 -4 0 1 -8 12 -18z m1825 -1977 l0 -745 -445 0 -445 0 0 745 0 745 445 0 445 0 0 -745z m100 -150 l0 -695 -445 0 -445 0 0 45 0 45 400 0 400 0 0 650 0 650 45 0 45 0 0 -695z" />
      <path d="M5055 1570 c-9 -14 3 -30 33 -41 19 -8 23 -12 13 -22 -9 -9 -16 -9 -32 2 -18 10 -20 10 -17 -1 6 -18 42 -22 56 -6 13 17 5 30 -28 45 -23 10 -24 11 -6 19 13 5 21 3 24 -4 2 -7 8 -12 14 -12 6 0 6 6 -2 15 -14 17 -46 20 -55 5z" />
      <path d="M5200 1570 c0 -5 6 -7 14 -4 24 9 29 -17 7 -40 -28 -29 -27 -36 7 -35 24 2 25 2 4 6 l-24 5 22 23 c13 14 20 31 17 39 -7 17 -47 22 -47 6z" />
      <path d="M5131 1523 c1 -36 2 -36 8 -9 9 42 29 44 34 4 l4 -33 1 38 c2 33 0 37 -23 37 -22 0 -25 -4 -24 -37z" />
      <path d="M5813 1538 c-38 -12 -42 -23 -13 -31 11 -3 20 -12 20 -21 0 -25 17 -19 24 8 3 13 9 31 12 40 7 18 3 18 -43 4z" />
      <path d="M5735 1428 l-70 -73 73 70 c67 64 77 75 69 75 -1 0 -34 -33 -72 -72z" />
      <path d="M6335 2575 c-143 -151 -267 -275 -275 -275 -22 0 -40 -20 -40 -44 0 -14 -101 -121 -307 -325 l-308 -303 270 260 c149 143 288 279 310 301 22 23 48 41 61 41 27 0 47 24 40 47 -4 14 59 86 254 291 230 241 268 283 258 282 -2 0 -120 -124 -263 -275z" />
    </g>
  </svg>`,
    shapes: [
      {
        type: "goal1",
        title: "Sub Element 1",
        x: 240,
        y: 150,
        width: 150,
        height: 60,
        text: "Sub Element 1",
      },
      {
        type: "goal1",
        title: "Goals",
        x: 40,
        y: 350,
        width: 150,
        height: 80,
        text: "Sub Element 2",
      },
      {
        type: "goal1",
        title: "Goals",
        x: 240,
        y: 350,
        width: 150,
        height: 80,
        text: "Sub Element 2",
      },
      {
        type: "goal1",
        title: "Goals",
        x: 440,
        y: 350,
        width: 150,
        height: 80,
        text: "Sub Element 2",
      },
      {
        type: "sacm3",
        title: "Sacm",
        x: 60,
        y: 500,
        width: 110,
        height: 150,
        text: "Sub Element 3",
      },
      {
        type: "sacm3",
        title: "Sacm",
        x: 360,
        y: 500,
        width: 110,
        height: 150,
        text: "Sub Element 3",
      },
    ],
    connections: [
      {
        from: "0",
        to: "1",
        style: "line" as const,
        fromPoint: "bottom",
        toPoint: "top",
      },
      {
        from: "0",
        to: "2",
        style: "line" as const,
        fromPoint: "bottom",
        toPoint: "top",
      },
      {
        from: "0",
        to: "3",
        style: "line" as const,
        fromPoint: "bottom",
        toPoint: "top",
      },
      {
        from: "1",
        to: "4",
        style: "line" as const,
        fromPoint: "bottom",
        toPoint: "top",
      },
      {
        from: "2",
        to: "5",
        style: "line" as const,
        fromPoint: "bottom",
        toPoint: "top",
      },
      {
        from: "3",
        to: "5",
        style: "line" as const,
        fromPoint: "bottom",
        toPoint: "top",
      },
    ],
  },
};

interface TemplateDialogProps {
  isOpen: boolean;
  onClose: () => void;
  onSelect: (template: string) => void;
}

const TemplateDialog: React.FC<TemplateDialogProps> = ({
  isOpen,
  onClose,
  onSelect,
}) => {
  const { addShape, addConnection } = useDiagramContext();

  if (!isOpen) return null;

  // Handler untuk menerapkan template yang dipilih ke canvas
  const applyTemplate = (templateKey: keyof typeof TEMPLATES) => {
    const template = TEMPLATES[templateKey];

    // Array untuk menyimpan ID shapes yang dibuat
    const shapeIds: string[] = [];

    // Buat semua shapes
    template.shapes.forEach((shapeData) => {
      const id = `${shapeData.type}-${Date.now()}-${Math.random()
        .toString(36)
        .substr(2, 5)}`;

      // Tambahkan shape ke canvas
      addShape({
        ...shapeData,
        id,
        preview: <div>Preview</div>, // Preview sederhana, ganti dengan komponen yang sesuai
      });

      // Simpan ID untuk connections
      shapeIds.push(id);
    });

    // Buat semua connections setelah shapes dibuat
    template.connections.forEach((connData) => {
      const fromId = shapeIds[parseInt(connData.from)];
      const toId = shapeIds[parseInt(connData.to)];

      // Tambahkan connection antar shapes dengan memperhatikan titik koneksi
      addConnection({
        id: `conn-${Date.now()}-${Math.random().toString(36).substr(2, 5)}`,
        from: fromId,
        to: toId,
        points: [],
        style: connData.style,
        // Tambahkan informasi tentang titik koneksi jika didukung oleh model data Anda
        fromPoint: connData.fromPoint,
        toPoint: connData.toPoint,
      } as any);
    });

    // Panggil callback onSelect
    onSelect(templateKey);

    // Tutup dialog
    onClose();
  };

  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
      <div className="bg-white rounded-xl w-[800px] max-h-[90vh] overflow-hidden">
        <div className="flex justify-between items-center p-6 border-b">
          <h2 className="text-xl font-semibold">Template</h2>
          <button
            onClick={onClose}
            className="text-gray-400 hover:text-gray-600"
          >
            <X size={24} />
          </button>
        </div>
        <div className="p-6">
          <div className="grid grid-cols-2 gap-6">
            {/* GSN Template */}
            <div
              className="cursor-pointer group"
              onClick={() => applyTemplate("gsn")}
            >
              <div className="h-48 bg-gray-50 rounded-lg mb-3 flex items-center justify-center border group-hover:border-blue-500">
                <div
                  className="w-full h-full p-2"
                  dangerouslySetInnerHTML={{ __html: TEMPLATES.gsn.previewSvg }}
                />
              </div>
              <h3 className="font-medium mb-1">{TEMPLATES.gsn.name}</h3>
              <p className="text-sm text-gray-500">
                {TEMPLATES.gsn.description}
              </p>
            </div>
            {/* SACM Template */}
            <div
              className="cursor-pointer group"
              onClick={() => applyTemplate("sacm")}
            >
              <div className="h-48 bg-gray-50 rounded-lg mb-3 flex items-center justify-center border group-hover:border-blue-500">
                <div
                  className="w-full h-full p-2"
                  dangerouslySetInnerHTML={{
                    __html: TEMPLATES.sacm.previewSvg,
                  }}
                />
              </div>
              <h3 className="font-medium mb-1">{TEMPLATES.sacm.name}</h3>
              <p className="text-sm text-gray-500">
                {TEMPLATES.sacm.description}
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default TemplateDialog;
